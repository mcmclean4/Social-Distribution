<style>

    h2{
        word-wrap: break-word;
    }

    #terminal_window{
        width: 100%;
        height: 300px; 
        overflow-y: auto; 
        border: 1px solid #ccc; 
        padding: 10px;
    }

    #table_lists{
        display: flex;
        gap: 40px;
    }

    #table_list{
        list-style-type: none;
        padding: 0;
    }

</style>

{% extends "admin/base_site.html" %}
{% block content %}
<meta name="csrf-token" content="{{ csrf_token }}">
<div>
    <h2>Tables in database:</h2>
    <div id="table_lists">
        <ul id="table_list">
        </ul>
    </div>
</div>

<div id="terminal_window">
    <h2 id="terminal_text"></h2>
</div>

<input type="text" id="input_text"></input>
<button id="submit_button">Send</button>

<script>
    
    document.addEventListener("DOMContentLoaded", function(){
            main();
    });


    class Terminal{
        constructor(){
            this.terminal_window = document.getElementById("terminal_window");
            this.terminal_text = document.getElementById("terminal_text");
            this.input = document.getElementById("input_text");
            this.submit_button = document.getElementById("submit_button");
            this.table_list = document.getElementById("table_list");
            this.submit_button.addEventListener("click", this.update.bind(this))

            this.start();

        }

        start(){
            let responseData = null;

            var testing = fetch('{% url "social:start_terminal" %}', {
                method: "POST",
                headers: { "Content-Type": "application/json", "X-CSRFToken": document.querySelector('meta[name="csrf-token"]').content },
                body: ""
            }).then(response => {
                if(!response.ok){
                    throw new Error('Command was not valid');
                }
                return response.json();
            }).then(data => {
                console.log(data[0]);
                for (const table of data['output']){
                    
                    this.table_list.innerHTML += `<li>${table}</li>`;
                }
            })
        }

        update(){

            let responseData = null;

            testing = fetch('{% url "social:send_command" %}', {
                method: "POST",
                headers: { "Content-Type": "application/json", "X-CSRFToken": document.querySelector('meta[name="csrf-token"]').content },
                body: ""
            }).then(response => {
                if(!response.ok){
                    throw new Error('Command was not valid');
                }
                return response.json();
            }).then(data => {
                
                this.terminal_text.innerHTML += `${data.output} <br></br>`;
            })
        
        }
    }

    function main(){
        terminal = new Terminal();
    }
    
</script>
{% endblock %}

